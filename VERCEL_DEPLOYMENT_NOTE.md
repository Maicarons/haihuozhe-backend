# Vercel 部署说明

## 问题描述
在 Vercel 部署过程中，出现以下错误：
```
sqlite3.OperationalError: unable to open database file
```

## 原因分析
Vercel 的无服务器函数环境具有以下特点：
1. 文件系统是只读的（除了特定的临时目录）
2. 函数实例是无状态的，每次调用之间不会保持数据
3. 无法持久化存储文件到常规路径

## 解决方案
我们修改了 `UserStorage` 类以支持两种存储模式：

### 1. 内存存储模式（推荐用于 Vercel）
- 当检测到 `VERCEL` 环境变量时，自动启用内存存储
- 通过设置环境变量 `USE_MEMORY_DB=true` 强制使用内存存储
- 数据在每次函数调用之间会丢失，适合无状态场景

### 2. 文件存储模式（用于本地开发）
- 默认在本地开发环境中使用
- 尝试使用临时目录存储数据库文件（如果在 Vercel 环境中且未启用内存模式）

## 主要修改

### 修改 1: `db/user_storage.py`
- 添加了环境检测逻辑
- 实现了内存存储和文件存储两种模式
- 通过 `USE_MEMORY_DB` 环境变量控制存储模式

### 修改 2: `api/app.py`
- 在 Vercel 环境中自动设置 `USE_MEMORY_DB=true`
- 确保在部署环境中使用正确的存储模式

## 部署建议

对于生产环境，建议：
1. 使用外部数据库服务（如 PostgreSQL、MySQL）
2. 使用 Vercel KV 或其他键值存储服务
3. 使用云函数提供的状态管理服务

当前实现允许应用在 Vercel 上正常启动，但请注意数据是临时的。